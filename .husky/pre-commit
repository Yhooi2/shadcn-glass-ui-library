#!/bin/sh

# Check for screenshot files being committed (macOS screenshots not allowed)
SCREENSHOTS=$(git diff --cached --name-only | grep '__screenshots__/' || true)

if [ -n "$SCREENSHOTS" ]; then
  echo "‚ùå ERROR: Screenshot files should not be committed locally"
  echo ""
  echo "Screenshots must be generated on Linux via GitHub Actions to ensure consistency."
  echo ""
  echo "To update screenshots:"
  echo "  1. Push your changes WITHOUT screenshots"
  echo "  2. Run: gh workflow run update-screenshots.yml"
  echo "  3. After workflow completes: git pull origin main"
  echo ""
  echo "To unstage screenshot files:"
  echo "  git reset HEAD src/components/__visual__/__screenshots__/"
  echo ""
  exit 1
fi

# Check for stories files being committed - run typecheck:stories
STORIES=$(git diff --cached --name-only | grep '\.stories\.tsx\?$' || true)

if [ -n "$STORIES" ]; then
  echo "üìñ Stories files detected, running typecheck..."
  if ! npm run typecheck:stories --silent 2>/dev/null; then
    echo ""
    echo "‚ö†Ô∏è  Stories typecheck failed!"
    echo "   Run 'npm run typecheck:stories' to see errors."
    echo "   Use 'git commit --no-verify' to skip this check."
    echo ""
    exit 1
  fi
  echo "‚úÖ Stories typecheck passed"
fi

# Run lint-staged
npx lint-staged
